const sendBtn = document.querySelector(".send-btn");
const textarea = document.querySelector(".ask-card textarea");
const chatContainer = document.getElementById("chat-container");

// Function to add a message bubble
function appendMessage(text, sender) {
  const msg = document.createElement("div");
  msg.classList.add("chat-message", sender);
  msg.textContent = text;
  chatContainer.appendChild(msg);
  chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function senndMessage() {
  const input = document.getElementById("userInput").value;
  const responseDiv = document.getElementById("ai-message");
  if (!input) {
    responseDiv.innerHTML = "ask your Querry.";
    return;
  }
  responseDiv.innerHTML = "typing...";
  try {
    const response = await fetch(
      "https://openrouter.ai/api/v1/chat/completions",
      {
        method: "POST",
        headers: {
          Authorization:
            "Bearer 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",
          "HTTP-Referer": "<YOUR_SITE_URL>", // Optional. Site URL for rankings on openrouter.ai.
          "X-Title": "<YOUR_SITE_NAME>", // Optional. Site title for rankings on openrouter.ai.
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          model: "deepseek/deepseek-r1:free",
          messages: [{ role: "user", content: input }],
        }),
      }
    );
    const data = await response.json();
    console.log(data);
    const markdownText = data.choics?.[0]/.message?.content || 'No response received.';
    responseDiv.innerHTML = marked.parse(markdownText);



  } catch (error) {
    responseDiv.innerHTML = "Error:" + error.message;
  }
}

// Handle send button
sendBtn.addEventListener("click", () => {
  const message = textarea.value.trim();
  if (message !== "") {
    appendMessage(message, "user");
    textarea.value = "";

    // Simulate AI response (for demo only)
    setTimeout(() => {
      appendMessage("This is a demo AI response ✨", "ai");
    }, 800);
  }
});

// Optional: Press Enter to send
textarea.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    sendBtn.click();
  }
});

// welcome page

const typewriterText = document.getElementById("typewriter-text");
const messages = [
  "Your futuristic AI chat assistant is ready.",
  "Type anything in the box below and hit send.",
  "Need answers? Ideas? Just ask!",
  "Built for speed, clarity, and intelligence.",
  "Try asking a question now — it's that simple.",
];

let messageIndex = 0;
let charIndex = 0;
let currentText = "";
let typing = true;

function typeWriter() {
  if (typing) {
    if (charIndex < messages[messageIndex].length) {
      currentText += messages[messageIndex][charIndex++];
      typewriterText.textContent = currentText;
      setTimeout(typeWriter, 50); // typing speed
    } else {
      typing = false;
      setTimeout(typeWriter, 1200); // wait before deleting
    }
  } else {
    if (charIndex > 0) {
      currentText = currentText.slice(0, --charIndex);
      typewriterText.textContent = currentText;
      setTimeout(typeWriter, 30); // deleting speed
    } else {
      typing = true;
      messageIndex = (messageIndex + 1) % messages.length;
      setTimeout(typeWriter, 100);
    }
  }
}

typeWriter();

// chat bot ki bari hai

const aiText = "Hello! I'm UjjwalByte's AskMe.ai. How can I help you today?";
const aiMessageDiv = document.getElementById("ai-message");

let i = 0;

function typeAiMessage() {
  if (i < aiText.length) {
    aiMessageDiv.textContent += aiText.charAt(i);
    i++;
    setTimeout(typeAiMessage, 40); // typing speed (adjustable)
  }
}

// Run typing effect once the page loads
window.addEventListener("load", typeAiMessage);
